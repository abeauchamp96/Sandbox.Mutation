name: $(Build.DefinitionName).$(Build.SourceBranchName).$(Date:yyyyMMdd).$(Rev:r)

pool: 'Hyrule'

trigger:
- develop
- main

stages:
- stage: Build_nugets
  displayName: 'Build nugets'
  jobs:
    - job: Build
      displayName: 'Build'
      variables:
        projects: '**/*.csproj'
        unitTestProjects: '**/*.Tests.csproj'
        buildConfiguration: 'Release'
      steps:
        - task: DotNetCoreCLI@2
          displayName: 'Restore packages'
          inputs:
            command: 'restore'
            projects: '$(projects)'
        - task: DotNetCoreCLI@2
          displayName: 'Compile the solution'
          inputs:
            command: build
            projects: $(projects)
            arguments: '--configuration $(buildConfiguration)'
        - task: DotNetCoreCLI@2
          displayName: 'Run unit tests'
          inputs:
            command: test
            projects: $(unitTestProjects)
            arguments: '--configuration $(buildConfiguration)'